## 题目描述
给你一根长度为 $n$ 的绳子，请把绳子剪成整数长度的 $m$ 段（$m$ 、$n$ 都是整数，$n>1$ 并且 $m>1$），每段绳子的长度记为  $k[0]$ ，$k[1]\ ...\ k[m-1]$ 。

请问 $k[0] \times k[1] \times ... \times k[m-1]$ 可能的最大乘积是多少？

例如，当绳子的长度是 $8$ 时，我们把它剪成长度分别为 $2$、$3$、$3$ 的三段，此时得到的最大乘积是18。

来源：力扣（LeetCode）/ 剑指 OFFER
链接：https://leetcode-cn.com/problems/jian-sheng-zi-lcof

## 解题思路
- 设将长度为 $n$ 的绳子切分为 $a$ 段：
$$
n = n_1 + n_2 + n_3 + ... + n_a
$$
- 等价于求解：
$$
max(n_1 \times n_2 \times ... \times n_a)
$$
> 数学推导分为两步：
> ① 当所有绳段长度相等时，乘积最大。
> ② 最优的绳段长度为 $3$ 。

**数学推导：**
由「算术几何均值不等式」：等号当且仅当在 $n_1 = n_2 = ... ... = n_a$时成立。
$$
\frac{n_1+n_2+...+n_a}{a} \ge \sqrt[a]{n_1n_2...n_a}
$$

> 推论1: 将绳子 **以相等的长度分为多段，** 得到的乘积最大。

- 设将绳子按照 $x$ 长度等分为 $a$ 段，即 $n = ax$，则乘积为 $x^a$。观察以下公式，由于 $n$ 为常数，因此当 $x^{\frac{1}{x}}$ 取最大值时， 乘积达到最大值。
$$
x^a = x^\frac{n}{x}=(x^\frac{1}{x})^n
$$

- 根据分析，可将问题转化为求 $y = x^{\frac{1}{x}}$ 的极大值，因此对 $x$ 求导数。

$$
lny = \frac{1}{x}
$$

$$
\frac{1}{y}y' = \frac{1}{x^2} - \frac{1}{x^2}lnx
$$

$$
= \frac{1-lnx}{x^2}
$$

$$
y' = \frac{1-lnx}{x^2} x^\frac{1}{x}
$$

令 $y'=0$，则 $1-lnx=0$，易得驻点 $x_0=e\approx2.7$，根据下面的分段可得知：$x_0$ 为极大值点：

$$
y'\begin{cases}
>0,\ x\in[-\infty, e)\\
<0,\ x\in(e, +\infty)
\end{cases}
$$

- 由于切分长度 $x$ 必须为整数，最接近 $e$ 的整数是 $2$ 或 $3$。如下式所示，带入 $x=2$ 和 $x=3$，得出 $x=3$时，乘积达到最大。

$$
y(3) = 3^\frac{1}{3} \approx 1.44
$$

$$
y(2) = 2^\frac{1}{2} \approx 1.41
$$

> **推论2：** 尽可能地将绳子以长度 $3$ 等分成多段，乘积最大。

**切分规则：**
1. 最优： $3$ 。把绳子尽可能切为多个长度为 $3$ 的片段，留下的最后一段绳子的长度可能为 $0,1,2$ 三种情况。
2. 次优： $2$ 。若最后一段绳子长度为 $2$ ；则保留，不再拆为 $1+1$。
3. 最差： $1$ 。若最后一段绳子长度为 $1$ ；则应把一份 $3 + 1$ 替换为 $2 + 2$，因为 $2 \times 2 > 3 \times 1$。

**算法流程：**
1. 当 $n \leq 3$ 时，按照规则应不切分，但由于题目要求必须剪成 $m>1$ 段，因此必须剪出一段长度为 $1$ 的绳子，即返回 $n - 1$。
2. 当 $n>3$ 时，求 $n$ 除以 $3$ 的 整数部分 $a$ 和 余数部分 $b$ （即 $n = 3a + b$ ），并分为以下三种情况：
- 当 $b = 0$ 时，直接返回 $3^a$；
- 当 $b = 1$ 时，要将一个 $1 + 3$ 转换为 $2+2$，因此返回 $3^{a-1} \times 4$；
- 当 $b = 2$ 时，返回 $3^a \times 2$。

![](https://rpzoss.oss-cn-chengdu.aliyuncs.com/picbed/2020-06-30-060101.png
)

**复杂度分析：**
- 时间复杂度 $O(1)$ ：仅有求整、求余、次方运算。
  - 求整和求余运算：资料提到不超过机器数的整数可以看作是 $O(1)$；
  - 幂运算：查阅资料，提到浮点取幂为 $O(1)$。

- 空间复杂度 $O(1)$ ：变量 `a` 和 `b` 使用常数大小额外空间。

## JavaScript 题解
```js
/**
 * @param {number} n
 * @return {number}
 */
var cuttingRope = function(n) {
    if (n <= 3) return n - 1;
    else {
        const a = Math.floor(n / 3);
        const b = n % 3;
        if (b == 0) {
            return Math.pow(3, a);
        } else if (b == 1) {
            return Math.pow(3, a-1) * 4;
        } else {
            return Math.pow(3, a) * 2;
        }
    }
};
```