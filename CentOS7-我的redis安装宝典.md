---
title: CentOS7 - æˆ‘çš„rediså®‰è£…å®å…¸
date: 2019-07-20 15:49:29
tags: 
  - Linux
  - æœåŠ¡å™¨è¿ç»´
---



> **Redis** æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ç¼“å­˜KVæ•°æ®åº“ï¼Œåœ¨å¾ˆå¤šWebå¼€å‘çš„åœºåˆæˆ‘ä»¬éƒ½éœ€è¦ç”¨åˆ°å®ƒï¼Œæ‰€ä»¥æˆ‘æƒ³åœ¨è¿™é‡Œè®°å½•ä¸‹æ¥æˆ‘å®‰è£… Redis çš„ä¸€å¥—æµç¨‹ä½œä¸ºé¿é›·è®°å½•ğŸ“~



##  ç¬¬ä¸€æ­¥ï¼šå…ˆè·Ÿç€å®˜ç½‘çš„æŒ‡å¼•ï¼Œä¸€æ­¥ä¹Ÿåˆ«æ¼ï¼

**å¦‚æ ‡é¢˜æ‰€ç¤ºï¼Œæœ‹å‹ã€‚**

ğŸ‘‰è®©æˆ‘ä»¬è®¿é—® Redis çš„ [å®˜æ–¹ç½‘ç«™ä¸‹è½½é¡µé¢](https://redis.io/download) , ä½ ä¼šçœ‹åˆ°æœ‰ä¸‰ä¸ªç‰ˆæœ¬çš„ Redis å¯ä¾›ä¸‹è½½ï¼š

- Unstableï¼š **ä¸æ¨èï¼Œå› ä¸ºè¿™æ˜¯å¼€å‘ç‰ˆï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šå¼€å‘æ—¶æœŸçš„å˜åŠ¨ï¼Œæ›´æ–°é¢‘ç¹ä¸åˆ©äºæœåŠ¡å™¨ç”Ÿäº§ç¯å¢ƒ** ~
- **Stable**ï¼šæˆ‘ä»¬é€‰çš„å°±æ˜¯ä»–ï¼è¯·è®°ä½ä¸‹é¢é‚£ä¸ªä¸‹è½½æŒ‰é’®ä¸Šçš„ç‰ˆæœ¬å· ~
- Dockerï¼šå¦‚æœä½ æ˜¯ç©Dockerçš„å¤§ç¥ä½ åº”è¯¥çŸ¥é“æ€ä¹ˆéƒ¨ç½²ï¼Œè€Œæˆ‘ä¸æ˜¯æ‰€ä»¥å°±ä¸å¤šè¯´å•¦ ~



**ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ CentOS æœåŠ¡å™¨çš„æ“ä½œï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šé€‰æ‹©ä¸‹è½½å®‰è£…åŒ…ç„¶ååˆç”¨XFtpä¹‹ç±»çš„å·¥å…·å†ä¸¢ä¸€é**

æˆ‘ä»¬ä¼šé€‰æ‹©åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ **wget / curl** å·¥å…·ä¸‹è½½

åœ¨ä¸‹è½½é¡µä¸Šçš„ `Installation` æ ‡é¢˜ä¸‹ï¼Œæœ‰å¦‚ä¸‹çš„å‚»ç“œå¼å‘½ä»¤æ•™ç¨‹ ï¼š

```bash
# ä¸‹è½½ Stable ç‰ˆæœ¬çš„ redis æºç ï¼Œå‡†å¤‡ä»æºç å®‰è£…
wget http://download.redis.io/releases/redis-5.0.5.tar.gz

# è§£å‹ä¸‹è½½å¥½çš„å‹ç¼©åŒ…
tar xzf redis-5.0.5.tar.gz

# è¿›å…¥åˆ°è§£å‹å‡ºçš„æ–‡ä»¶å¤¹ä¸­
cd redis-5.0.5

# æ‰§è¡Œ make ä¹‹å‰ è¯·ä½ ç¡®ä¿ä½ çš„æœåŠ¡å™¨ä¸Šæœ‰ GCC å·¥å…·
# å¦‚æœæ²¡æœ‰è¯·å…ˆ  yum install gcc
make
```

å®˜ç½‘å¯¹äºå®‰è£…å°±åªè¯´äº†è¿™ä¹ˆå¤šï¼Œä¸‹é¢ä»–å°±å°†æ•™ä½ æ€ä¹ˆæµ‹è¯•ï¼š

**ğŸ‘‡ä¸‹é¢ä½ çœ‹åˆ°çš„ src æ˜¯ä½ è§£å‹å‡ºçš„ redis-x.x.x çš„ src æ–‡ä»¶å¤¹**

```bash
# ç¡®ä¿ä½ è‡ªå·±æ˜¯åœ¨ redis-x.x.x çš„æ ¹ç›®å½•ä¸‹å¯åŠ¨ redis æœåŠ¡å™¨ç¨‹åº
[root@Aliyun  redis-5.0.5]$ src/redis-server
```

å¯åŠ¨ä¹‹åä½ å°±ä¼šçœ‹åˆ°ä¸€ä¸ª **ç”¨å­—ç¬¦æ‰“å°å‡ºçš„ redis çš„ logo**ï¼Œå¹¶ä¸”ç¨‹åºä¸€ç›´åœ¨æŒ‚èµ·æ‰§è¡Œï¼Œä½ æ²¡æ³•å›åˆ°å‘½ä»¤è¡Œä¸‹ï¼Œ**é™¤éä½  ctrl + c ä¸»åŠ¨ç»“æŸ redis æœåŠ¡å™¨ç¨‹åº** 



```bash
# è¿™é‡Œæ¼”ç¤ºçš„æ˜¯å¯åŠ¨ redis å®¢æˆ·ç«¯
[root@Aliyun  redis-5.0.5]$ src/redis-cli
redis> set name "shenqingchuan"
OK 		# <- è¿™é‡Œæ˜¯ K V é”®å€¼å¯¹è®¾ç½®æˆåŠŸå redis çš„æç¤º
redis> get name
"shenqingchuan"			# <- ä½ å¯ä»¥ä½¿ç”¨ get æ¥å¾—åˆ°æŸä¸ªé”®æ‰€å¯¹åº”çš„çš„å€¼
```



## ç¬¬äºŒæ­¥ï¼šä½ å¯æ˜¯ä¸ªæ•°æ®åº“ï¼Œä½ å¾—ä¸€ç›´åœ¨å•Šè€å…„ï¼

**ä½ å½“ç„¶ä¼šè¯´ï¼Œè¿™æœ‰ä½•éš¾ï¼Œå¼€ä¸ª tmux æŒ‚èµ·è¿è¡Œä¸å°±å®Œäº†å—ï¼Œå¤šå¤§ç‚¹äº‹å„¿ ~**

å¯å¦‚æœæœåŠ¡å™¨é‡å¯äº†å‘¢ï¼Œä½ çš„ç¼“å­˜æœåŠ¡å™¨å¯å°±æŒ‚äº†å“¦ ~ æ‰€ä»¥è¿˜æ˜¯å°† redis é…ç½®æˆä¸º service æœåŠ¡æ›´ç¨³å¦¥ã€‚

å…·ä½“å¦‚ä½•æ“ä½œå‘¢ï¼Ÿè¯·è·Ÿæˆ‘ä¸€æ­¥æ­¥æ¥ï¼š



1. æˆ‘ä»¬åˆšåˆšä¸æ˜¯æ‰§è¡Œäº† make å—ï¼Ÿå¯ç†Ÿæ‚‰ make çš„åŒå­¦éƒ½çŸ¥é“ï¼Œä¸€èˆ¬ make è¿‡åéƒ½ä¼šæœ‰ä¸€æ­¥ install 

   ```bash
   # è¿›å…¥ redis-x.x.x æºç æ–‡ä»¶å¤¹çš„ src ç›®å½•ä¸‹
   cd redis-5.0.5/src
   
   # æ‰§è¡Œå®‰è£…
   make install
   
   # ç„¶åä½ å¯ä»¥æµ‹è¯•ä¸€ä¸‹ redis-server æ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨æ‰§è¡Œäº†
   redis-server
   # æ˜¾ç„¶åº”è¯¥æ‰“å°å‡º redis çš„ logo
   ```

2. åšå®Œç¬¬ä¸€æ­¥ï¼Œåªèƒ½è¯´æ˜æˆ‘ä»¬å°† redis å®‰è£…åˆ°äº† /usr/local/bin è¿™ä¸ªç›®å½•ä¸‹ï¼ˆç†Ÿæ‚‰ Linux çš„åŒå­¦éƒ½åº”è¯¥çŸ¥é“è¿™ä¸ªç›®å½•ä½œä¸º PATH çš„æ„ä¹‰ï¼‰

   ä½†æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åšæˆ serviceï¼š

   ```bash
   # é¦–å…ˆåšä¸‹é¢çš„æ“ä½œæ—¶è¯·ç¡®ä¿ä½ ä»ç„¶è¿˜åœ¨ redis-x.x.x çš„ src ç›®å½•ä¸‹
   # åˆ›å»º redis çš„ä¸“å±ç›®å½•
   mkdir -p /usr/local/redis
   
   # æ‹·è´ä¸¤ä¸ªç¼–è¯‘å®Œæˆçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶åˆ° åˆšåˆšåˆ›å»ºçš„ç›®å½•ä¸­
   cp ./redis-server /usr/local/redis
   cp ./redis-cli /usr/local/redis
   
   # å›åˆ° redis-x.x.x çš„æ ¹ç›®å½•ï¼ŒæŠŠ redis çš„å¯åŠ¨é…ç½®æ–‡ä»¶ ä¹Ÿæ‹·è´åˆ°ä¸“å±ç›®å½•ä¸­
   cd ..
   cp redis.conf /usr/local/redis/
   
   # åˆ‡æ¢åˆ° redis ä¸“å±ç›®å½•, ç¼–è¾‘é…ç½®æ–‡ä»¶
   vi redis.conf
   
   ```

   å¤§çº¦åœ¨æ–‡ä»¶çš„ç¬¬ 128 è¡Œï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ª `daemonize no`

   æˆ‘ä»¬å°†å®ƒæ”¹ä¸ºï¼š**daemonize yes**

   > **æ¸©é¦¨å°æç¤ºï¼š**
   >
   > å¦‚æœä½ æ˜¯ä¸ª vim æ–°æ‰‹ï¼Œä¸æƒ³ä¸€è¡Œä¸€è¡Œæ…¢æ…¢çœ‹ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶é‡Œçš„æ³¨é‡Šå®åœ¨æ˜¯å¤ªå¤šï¼Œè€Œä½ çš„æœåŠ¡å™¨ç¯å¢ƒé‡Œçš„ vim ä¸ä¸€å®šæœ‰è¡Œå·ï¼š
   >
   > é‚£ä¹ˆä½ å¯ä»¥åœ¨å‘½ä»¤æ¨¡å¼ä¸‹æ•²ä¸€ä¸ª `/`
   >
   > ç„¶åè¾“å…¥ daemonize å°±å¯ä»¥æ‰¾åˆ°å•¦ ~ 
   >
   >  
   >
   > **çœ‹ï¼Œä¸ºäº†å­¦ redis çš„é…ç½®ï¼Œä½ è¿˜å¤šå­¦ä¼šäº†ä¸€æ‹› vim çš„æŸ¥æ‰¾ ~**

3. **æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡ï¼Œ**å…¶å®å°±æ˜¯ç»™ systemd å¤šå†™ä¸ª service æ–‡ä»¶ ğŸ˜„

   **`vi /usr/lib/systemd/system/redis-server.service`**

   ä»¥ä¸‹å†…å®¹å¤åˆ¶å³å¯ï¼Œå› ä¸ºå¦‚æœä½ ç…§ç€æˆ‘åˆšæ‰çš„æ­¥éª¤åšï¼Œä½ çš„ redis server å¯åŠ¨åœ°å€å°±æ˜¯æˆ‘ä»¬è‡ªå»ºçš„ä¸“å±æ–‡ä»¶å¤¹ï¼š

   ```bash
   [Unit]
   Description=The redis-server Process Manager
   After=syslog.target network.target
   
   [Service]
   Type=simple
   PIDFile=/var/run/redis.pid
   ExecStart=/usr/local/redis/redis-server       
   ExecReload=/bin/kill -USR2 $MAINPID
   ExecStop=/bin/kill -SIGINT $MAINPID
   
   [Install]
   WantedBy=multi-user.target
   ```

4. **å°†æœåŠ¡å¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªè¿è¡Œï¼š**

   ```bash
   # é‡æ–°è½½å…¥å®‰è£…çš„æœåŠ¡
   systemctl daemon-reload
   
   # å¯åŠ¨ redis-server æœåŠ¡
   systemctl start redis-server.service
   
   systemctl enable redis-server.service
   ```

5. **æ£€æŸ¥ Redis server æ˜¯å¦åœ¨è¿è¡Œï¼š**

   ```bash
   [root@Aliyun ~]$ ps -A|grep redis
   ```

   ç»“æœåº”å½“æ˜¾ç¤ºä¸€ä¸ª redis-server è¿›ç¨‹æ­£åœ¨è¿è¡Œã€‚

   æ­¤æ—¶å†å»ç”¨ `redis-cli` æµ‹è¯•ä¸€ä¸‹å®¢æˆ·ç«¯æ˜¯å¦å¯ç”¨ï¼Œä¸€åˆ‡éƒ½æ²¡é—®é¢˜çš„è¯ï¼Œæ­å–œä½ å®‰è£…å®Œæˆï¼~

